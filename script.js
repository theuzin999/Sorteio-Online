const{useState,useEffect,Component,useMemo,useRef}=React;const firebaseConfig={apiKey:"AIzaSyCYsddBeNnv7eCtS8yErh0xKhd0D3P6XIs",authDomain:"participantes-a08a8.firebaseapp.com",projectId:"participantes-a08a8",storageBucket:"participantes-a08a8.firebasestorage.app",messagingSenderId:"57836101729",appId:"1:57836101729:web:78483d3d3ad16af6fa4a20",measurementId:"G-09HBH0BCNW"};let db;try{if(!firebase.apps.length){firebase.initializeApp(firebaseConfig)}
db=firebase.firestore();console.log("Firebase conectado com sucesso!")}catch(error){console.error("Erro ao inicializar Firebase:",error);alert("Erro crítico: Não foi possível conectar ao banco de dados.")}
const User=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>);const Mail=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>);const Smartphone=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>);const AlertTriangle=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>);const History=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path><path d="M12 7v5l4 2"></path></svg>);const Lock=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>);const Eye=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>);const EyeOff=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" x2="23" y1="1" y2="23"/></svg>);const Calendar=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>);const Trash=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke={props.color||"currentColor"}strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>);const Download=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke={props.color||"currentColor"}strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>);const Edit2=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5L2 22l1.5-5.5L17 3z"></path></svg>);const RotateCcw=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>);const X=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>);const Trophy=(props)=>(<svg xmlns="http://www.w3.org/2000/svg" width={props.size||24}height={props.size||24}viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V2Z"/></svg>);class ErrorBoundary extends Component{state={hasError:!1};static getDerivedStateFromError(error){return{hasError:!0}}
render(){if(this.state.hasError)return<h1 className="text-red-500 text-center mt-10 font-bold text-lg">Algo deu errado.Atualize a página.</h1>;return this.props.children}}
const STORAGE_KEYS={DRAW_DATE:'telegram_draw_date',ADMIN:'telegram_admin_logged',DAY_LOCKED:'telegram_day_locked',ADMIN_SELECTED_DATE:'telegram_admin_selected_date'};const COLLECTIONS={BANCAS:'bancas_participants',VIVO:'vivo_participants',HISTORY:'draw_history',ADMIN:'keyadmin'}
const getSaoPauloDateString=()=>{const options={timeZone:'America/Sao_Paulo',year:'numeric',month:'2-digit',day:'2-digit'};const formatter=new Intl.DateTimeFormat('fr-CA',options);return formatter.format(new Date())};const useData=()=>{const[bancasParticipants,setBancasParticipants]=useState([]);const[vivoParticipants,setVivoParticipants]=useState([]);const[history,setHistory]=useState([]);const[currentSaoPauloDate,setCurrentSaoPauloDate]=useState(getSaoPauloDateString());const[drawDate,setDrawDate]=useState(()=>{const storedDate=localStorage.getItem(STORAGE_KEYS.DRAW_DATE);const spDate=getSaoPauloDateString();if(storedDate&&new Date(storedDate)<=new Date(spDate)){return storedDate}
return spDate});const[isAdmin,setIsAdmin]=useState(()=>localStorage.getItem(STORAGE_KEYS.ADMIN)==='true');const[isDayLocked,setIsDayLocked]=useState(()=>localStorage.getItem(STORAGE_KEYS.DAY_LOCKED)==='true');const[deletedItem,setDeletedItem]=useState(null);const[clearedWinnersBackup,setClearedWinnersBackup]=useState(null);const[deletedParticipant,setDeletedParticipant]=useState(null);const undoTimeoutRef=useRef(null);const undoParticipantTimeoutRef=useRef(null);useEffect(()=>{if(!db)return;const unsubBancas=db.collection(COLLECTIONS.BANCAS).onSnapshot(snapshot=>{const data=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));setBancasParticipants(data.sort((a,b)=>new Date(a.registrationDate)-new Date(b.registrationDate)))});const unsubVivo=db.collection(COLLECTIONS.VIVO).onSnapshot(snapshot=>{const data=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));setVivoParticipants(data.sort((a,b)=>new Date(a.registrationDate)-new Date(b.registrationDate)))});const unsubHistory=db.collection(COLLECTIONS.HISTORY).onSnapshot(snapshot=>{const data=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));setHistory(data.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp)))});return()=>{unsubBancas();unsubVivo();unsubHistory()}},[]);useEffect(()=>{const interval=setInterval(()=>{const newSaoPauloDate=getSaoPauloDateString();setCurrentSaoPauloDate(newSaoPauloDate);setDrawDate(prevDrawDate=>{const today=new Date(newSaoPauloDate);const currentDraw=new Date(prevDrawDate);if(currentDraw<today){console.log("Meia-noite em SP. Avançando data do sorteio para:",newSaoPauloDate);return newSaoPauloDate}
return prevDrawDate})},60000);return()=>clearInterval(interval)},[]);useEffect(()=>{localStorage.setItem(STORAGE_KEYS.DRAW_DATE,drawDate)},[drawDate]);useEffect(()=>{localStorage.setItem(STORAGE_KEYS.ADMIN,isAdmin)},[isAdmin]);useEffect(()=>{localStorage.setItem(STORAGE_KEYS.DAY_LOCKED,isDayLocked)},[isDayLocked]);useEffect(()=>{const isLocked=localStorage.getItem(STORAGE_KEYS.DAY_LOCKED)==='true';const today=getSaoPauloDateString();if(isLocked&&drawDate&&new Date(drawDate)<new Date(today)){setIsDayLocked(!1)}},[drawDate]);const addParticipant=async(type,newParticipant)=>{const dataDeInscricaoCorreta=getSaoPauloDateString();if(isDayLocked)return{success:!1,message:'Cadastros bloqueados. O dia da live foi finalizado.'};if(!db)return{success:!1,message:'Erro de conexão com o banco de dados.'};const collectionName=type==='bancas'?COLLECTIONS.BANCAS:COLLECTIONS.VIVO;const participants=type==='bancas'?bancasParticipants:vivoParticipants;const participantsToday=participants.filter(p=>p.date===dataDeInscricaoCorreta);if(participantsToday.some(p=>p.email.toLowerCase()===newParticipant.email.toLowerCase()))return{success:!1,message:'E-mail já cadastrado para hoje!'};if(participantsToday.some(p=>p.whatsapp===newParticipant.whatsapp))return{success:!1,message:'WhatsApp já cadastrado para hoje!'};try{await db.collection(collectionName).add({...newParticipant,registrationDate:new Date().toISOString(),date:dataDeInscricaoCorreta});return{success:!0,message:'Cadastro realizado com sucesso!'}}catch(error){return{success:!1,message:'Erro ao salvar no banco de dados.'}}};const addToHistory=async(entry)=>{if(!db)return;try{await db.collection(COLLECTIONS.HISTORY).add({...entry,date:drawDate,timestamp:new Date().toISOString()})}catch(error){console.error("Erro ao add histórico: ",error)}};const updateHistoryEntry=async(id,newFields)=>{if(!db)return;try{await db.collection(COLLECTIONS.HISTORY).doc(id).update(newFields)}catch(error){console.error("Erro ao atualizar histórico: ",error)}};const removeParticipant=async(type,participantId)=>{if(!db)return;const collectionName=type==='bancas'?COLLECTIONS.BANCAS:COLLECTIONS.VIVO;const list=type==='bancas'?bancasParticipants:vivoParticipants;const itemToDelete=list.find(p=>p.id===participantId);if(itemToDelete){setDeletedParticipant({...itemToDelete,type:type});if(undoParticipantTimeoutRef.current)clearTimeout(undoParticipantTimeoutRef.current);undoParticipantTimeoutRef.current=setTimeout(()=>setDeletedParticipant(null),5000);try{await db.collection(collectionName).doc(participantId).delete()}catch(error){console.error("Erro remover part.: ",error);setDeletedParticipant(null)}}};const undoDeleteParticipant=async()=>{if(!deletedParticipant||!db)return;try{const{id,type,...dataToRestore}=deletedParticipant;const collectionName=type==='bancas'?COLLECTIONS.BANCAS:COLLECTIONS.VIVO;await db.collection(collectionName).add(dataToRestore);setDeletedParticipant(null);if(undoParticipantTimeoutRef.current)clearTimeout(undoParticipantTimeoutRef.current);}catch(error){console.error("Erro ao desfazer exclusão de participante: ",error);alert("Erro ao restaurar participante.")}};const removeHistoryEntry=async(entryId)=>{if(!db)return;const itemToDelete=history.find(h=>h.id===entryId);if(itemToDelete){setDeletedItem(itemToDelete);if(undoTimeoutRef.current)clearTimeout(undoTimeoutRef.current);undoTimeoutRef.current=setTimeout(()=>setDeletedItem(null),5000);try{await db.collection(COLLECTIONS.HISTORY).doc(entryId).delete()}catch(error){console.error("Erro deletar hist.: ",error)}}};const undoDelete=async()=>{if(!deletedItem||!db)return;try{const{id,...dataToRestore}=deletedItem;await db.collection(COLLECTIONS.HISTORY).add(dataToRestore);setDeletedItem(null);if(undoTimeoutRef.current)clearTimeout(undoTimeoutRef.current);}catch(error){console.error("Erro ao desfazer: ",error);alert("Erro ao restaurar item.")}};const clearWinnersForDate=async(date)=>{if(!db)return{success:!1,message:'Erro de conexão com o banco de dados.'};try{const snapshot=await db.collection(COLLECTIONS.HISTORY).where('date','==',date).get();if(snapshot.docs.length===0)return{success:!0,message:'Nenhum ganhador para limpar nesta data.'};const itemsToBackup=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));setClearedWinnersBackup(itemsToBackup);if(undoTimeoutRef.current)clearTimeout(undoTimeoutRef.current);undoTimeoutRef.current=setTimeout(()=>setClearedWinnersBackup(null),10000);const batch=db.batch();snapshot.docs.forEach(doc=>batch.delete(doc.ref));await batch.commit();return{success:!0,message:`${itemsToBackup.length} ganhadores limpos com sucesso!`}}catch(error){console.error("Erro ao limpar ganhadores: ",error);setClearedWinnersBackup(null);return{success:!1,message:'Erro ao limpar ganhadores.'}}};const undoClearWinners=async()=>{if(!clearedWinnersBackup||!db)return;try{const batch=db.batch();clearedWinnersBackup.forEach(item=>{const{id,...dataToRestore}=item;batch.set(db.collection(COLLECTIONS.HISTORY).doc(),dataToRestore)});await batch.commit();setClearedWinnersBackup(null);if(undoTimeoutRef.current)clearTimeout(undoTimeoutRef.current);}catch(error){console.error("Erro ao desfazer limpeza: ",error);alert("Erro ao restaurar ganhadores.")}};const clearAllParticipantsForDate=async(type,date)=>{if(!db)return;const collectionName=type==='bancas'?COLLECTIONS.BANCAS:COLLECTIONS.VIVO;try{const snapshot=await db.collection(collectionName).where('date','==',date).get();if(snapshot.docs.length===0){alert(`Nenhum participante de '${type}' para limpar na data ${date}.`);return}
const batch=db.batch();snapshot.docs.forEach(doc=>batch.delete(doc.ref));await batch.commit();alert(`${snapshot.docs.length} participantes de '${type}' limpos da data ${date}.`)}catch(error){console.error("Erro limpar parts: ",error);alert("Erro ao limpar participantes.")}};const verifyAdminPassword=async(passwordInput)=>{if(!db)return!1;try{const doc=await db.collection(COLLECTIONS.ADMIN).doc('1').get();if(doc.exists)return passwordInput===doc.data().key;return passwordInput==='admin123'}catch(error){return passwordInput==='admin123'}};return{bancasParticipants,vivoParticipants,history,drawDate,setDrawDate,currentSaoPauloDate,isAdmin,setIsAdmin,isDayLocked,addParticipant,addToHistory,verifyAdminPassword,updateHistoryEntry,removeParticipant,removeHistoryEntry,clearAllParticipantsForDate,undoDelete,deletedItem,clearWinnersForDate,undoClearWinners,clearedWinnersBackup,deletedParticipant,undoDeleteParticipant}};const formatWhatsapp=(value)=>{let v=value.replace(/\D/g,'');v=v.substring(0,13);let formatted='+';if(v.length>0){formatted+=v.substring(0,2)}
if(v.length>2){formatted+=' ('+v.substring(2,4)}
if(v.length>4){formatted+=') ';const numberDigits=v.substring(4);if(numberDigits.length>0&&numberDigits[0]==='9'){formatted+=numberDigits.substring(0,5);if(numberDigits.length>5){formatted+='-'+numberDigits.substring(5,9)}}else{formatted+=numberDigits.substring(0,4);if(numberDigits.length>4){formatted+='-'+numberDigits.substring(4,8)}}}
return formatted}
const RegistrationForm=({type,title})=>{const{addParticipant,isDayLocked}=useData();const[formData,setFormData]=useState({name:'',email:'',whatsapp:'+55'});const[message,setMessage]=useState('');const[isError,setIsError]=useState(!1);const[loading,setLoading]=useState(!1);const[showEmailWarning,setShowEmailWarning]=useState(!1);const handleChange=(e)=>{const{name,value}=e.target;setMessage('');if(name==='name'){if(/^[a-zA-Z\u00C0-\u00FF\s]*$/.test(value)){setFormData(prev=>({...prev,[name]:value}))}}else if(name==='whatsapp'){const formattedValue=formatWhatsapp(value);setFormData(prev=>({...prev,[name]:formattedValue}))}else{setFormData(prev=>({...prev,[name]:value}))}};const handleSubmit=async(e)=>{e.preventDefault();setLoading(!0);const result=await addParticipant(type,formData);setLoading(!1);setIsError(!result.success);setMessage(result.message);if(result.success)setFormData({name:'',email:'',whatsapp:'+55'})};const inputClass=`w-full pl-10 pr-3 py-2 bg-gray-900 border border-red-600 text-white rounded-md focus:border-orange-500 focus:ring-0 ${isDayLocked ? 'opacity-50 cursor-not-allowed' : ''}`;const iconClass="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-red-600";const formId=type==='bancas'?'bancas':'vivo';return(<div className="rounded-xl bg-black/90 border-2 border-red-600 shadow-[0_0_20px_rgba(255,0,0,0.4)] hover:shadow-[0_0_30px_rgba(255,69,0,0.6)] transition-all duration-300 p-6"><h2 className="text-2xl font-semibold text-red-600 mb-4">{title}</h2>{isDayLocked&&(<div className="flex items-center p-3 mb-4 rounded-lg bg-red-900 bg-opacity-70 text-white shadow-md"><AlertTriangle className="h-5 w-5 mr-2 text-red-500"/><span>Cadastros bloqueados.O dia da live foi finalizado.</span></div>)}
{message&&(<div className={`flex items-center p-3 mb-4 rounded-lg shadow-md ${isError ? 'bg-red-900 bg-opacity-70 text-white' : 'bg-green-800 bg-opacity-70 text-white'}`}><AlertTriangle className="h-5 w-5 mr-2"/><span>{message}</span></div>)}<form onSubmit={handleSubmit}className="space-y-4"><div><label className="block text-sm text-gray-300 mb-1" htmlFor={`${formId}-name`}>Nome Completo</label><div className="relative"><User className={iconClass}/><input
type="text"
name="name"
placeholder="Seu nome (apenas letras)"
value={formData.name}
onChange={handleChange}
id={`${formId}-name`}
className={inputClass}
required
disabled={isDayLocked}/></div></div><div><label className="block text-sm text-gray-300 mb-1" htmlFor={`${formId}-email`}>E-mail</label><div className="relative"><Mail className={iconClass}/><input
type="email"
name="email"
placeholder="seu@email.com"
value={formData.email}
onChange={handleChange}
onFocus={()=>setShowEmailWarning(!0)}
onBlur={()=>setShowEmailWarning(!1)}
id={`${formId}-email`}
className={inputClass}
required
disabled={isDayLocked}/></div>{showEmailWarning&&(<div className="mt-2 p-2 bg-yellow-900/40 border border-yellow-600 text-yellow-200 text-xs rounded-md animate-pulse"><p className="flex items-center gap-1"><AlertTriangle size={12}/>Preencha com seu email de cadastro,não será possível alterá-lo após o envio.</p></div>)}</div><div><label className="block text-sm text-gray-300 mb-1" htmlFor={`${formId}-whatsapp`}>WhatsApp</label><div className="relative"><Smartphone className={iconClass}/><input
type="tel"
name="whatsapp"
placeholder="+55 (XX) XXXXX-XXXX"
value={formData.whatsapp}
onChange={handleChange}
id={`${formId}-whatsapp`}
className={inputClass}
required
disabled={isDayLocked}/></div></div><button type="submit" className={`w-full py-2 bg-gradient-to-r from-red-600 to-orange-500 text-white font-semibold rounded-md hover:from-red-700 hover:to-orange-600 transition-all hover:shadow-[0_0_20px_rgba(255,69,0,0.8)] ${isDayLocked ? 'opacity-50 cursor-not-allowed' : ''}`}disabled={isDayLocked||loading}>{loading?'Enviando...':'Confirmar Participação'}</button></form></div>)};const Modal=({isOpen,onClose,children})=>{if(!isOpen)return null;return(<div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4"><div className="rounded-xl bg-black/90 border-2 border-red-600 shadow-[0_0_20px_rgba(255,0,0,0.4)] max-w-md w-full p-6">{children}<button onClick={onClose}className="mt-4 w-full bg-gray-700 hover:bg-gray-600 text-white p-2 rounded-md transition-all">Fechar</button></div></div>)};const exportFormattedTXT=(data,type,date)=>{if(data.length===0){}
let content="";if(type==='bancas'){content=data.map(p=>{return `*${p.name}:* ${p.email}\nwhatsapp: ${p.whatsapp}`}).join('\n\n')}else{content=data.map(p=>{const resultText=p.result?p.result:"Aguardando resultado";return `*${p.name}:* ${p.email}\nwhatsapp: ${p.whatsapp}\n${resultText}`}).join('\n\n')}
if(content.length===0){content=`Nenhum ganhador registrado para o sorteio de ${type === 'bancas' ? '20 Bancas' : 'Ao Vivo'} na data ${date}.`}
const blob=new Blob([content],{type:'text/plain;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.setAttribute('download',`ganhadores_${type}_${date}.txt`);document.body.appendChild(link);link.click();document.body.removeChild(link)};const exportParticipantsCSV=(data,filename)=>{if(data.length===0){alert("Sem dados.");return}
const headers=['Nome','Email','WhatsApp','Data Cadastro'];const csv=[headers.join(';'),...data.map(row=>[row.name,row.email,row.whatsapp,new Date(row.registrationDate).toLocaleString('pt-BR')].join(';'))].join('\n');const blob=new Blob([new Uint8Array([0xEF,0xBB,0xBF]),csv],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.setAttribute('download',filename);document.body.appendChild(link);link.click();document.body.removeChild(link)}
const FullScreenWinnerDisplay=({isOpen,onClose,type,winners,drawDate})=>{if(!isOpen)return null;const winnerData=type==='bancas'?winners:winners.filter(w=>w.type==='Ao Vivo');const title=type==='bancas'?`20 VENCEDORES DAS BANCAS (${drawDate})`:`GANHADORES AO VIVO (${drawDate})`;const isBancas=type==='bancas';const maskEmail=(email)=>{if(!email)return'N/A';const[user,domain]=email.split('@');const maskedUser=user.length>3?`${user.slice(0, 2)}***${user.slice(-1)}`:'***';return `${maskedUser}@...`};return(<div className="fixed inset-0 z-[60] bg-black bg-opacity-95 overflow-y-auto p-4"><button onClick={onClose}className="absolute top-4 right-4 text-white hover:text-red-500 transition-all p-3 rounded-full bg-red-600/50 hover:bg-red-600"><X size={32}/></button><div className="max-w-7xl mx-auto py-10"><h1 className="text-4xl sm:text-5xl font-bold text-center text-red-600 mb-8 border-b-4 border-red-600 pb-4">{title}</h1><div className={`grid gap-6 ${isBancas ? 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-4' : 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3'}`}>{winnerData.map((winner,index)=>(<div
key={index}
className={`p-6 rounded-xl border-4 transition-all duration-300 transform hover:scale-[1.02] 
                                ${isBancas ?
            'border-yellow-500 bg-yellow-900/40 shadow-[0_0_25px_rgba(255,215,0,0.6)]' :
            (winner.status === 'profit' ?
                'border-green-500 bg-green-900/40 shadow-[0_0_25px_rgba(0,255,0,0.6)]' :
                'border-red-500 bg-red-900/40 shadow-[0_0_25px_rgba(255,0,0,0.6)]')
            }`}><div className="flex justify-between items-center mb-3"><span className={`text-2xl sm:text-3xl font-extrabold ${isBancas ? 'text-yellow-400' : (winner.status === 'profit' ? 'text-green-400' : 'text-red-400')}`}>#{index+1}</span><Trophy size={40}className={`transform rotate-[-10deg] ${isBancas ? 'text-yellow-400' : (winner.status === 'profit' ? 'text-green-400' : 'text-red-400')}`}/></div><p className="text-xl font-bold text-white mb-2 truncate">{winner.name}</p><p className="text-sm text-gray-300 mb-4">{maskEmail(winner.email)}</p>{!isBancas&&winner.result&&(<div className="mt-2 pt-2 border-t border-gray-700"><p className={`text-lg font-bold ${winner.status === 'profit' ? 'text-green-500' : 'text-red-500'}`}>{winner.result}</p></div>)}</div>))}
{winnerData.length===0&&<p className="text-center text-xl text-gray-400 col-span-full">Nenhum ganhador registrado para exibição.</p>}</div></div></div>)};const HistoryList=({isEmbedded=!1,adminControls=!1,historyEntries,removeEntry,editEntry,title})=>{const[showFullEmail,setShowFullEmail]=useState({});const[showFullWhatsApp,setShowFullWhatsApp]=useState({});const{history,drawDate}=useData();const[selectedDate,setSelectedDate]=useState(isEmbedded?drawDate:getSaoPauloDateString());const toggleEmail=(id)=>setShowFullEmail(prev=>({...prev,[id]:!prev[id]}));const toggleWhatsApp=(id)=>setShowFullWhatsApp(prev=>({...prev,[id]:!prev[id]}));const maskEmail=(email)=>{if(!email)return'N/A';const[user,domain]=email.split('@');const maskedUser=user.length>3?`${user.slice(0, 2)}***${user.slice(-1)}`:'***';return `${maskedUser}@...`};const maskWhatsApp=(whatsapp)=>{if(!whatsapp||whatsapp.length<5)return'N/A';return `${whatsapp.slice(0, 4)}***${whatsapp.slice(-4)}`};const entriesToDisplay=useMemo(()=>{if(historyEntries)return historyEntries;if(isEmbedded&&!adminControls){return history.filter(entry=>entry.date===selectedDate)}
return history.filter(entry=>entry.date===selectedDate)},[historyEntries,history,selectedDate,isEmbedded,adminControls]);const displayedEntries=(adminControls?entriesToDisplay:entriesToDisplay.filter(entry=>(entry.result||entry.type==='20 Bancas'||(entry.type==='Ao Vivo'&&entry.result===null))))||[];const sortedEntries=[...displayedEntries].sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));return(<div className={`${isEmbedded ? 'mt-4' : 'rounded-xl bg-black/90 border-2 border-red-600 shadow-[0_0_20px_rgba(255,0,0,0.4)] p-6'}`}>{title&&<h4 className="font-bold text-red-600 mb-3 text-lg">{title}</h4>}
{isEmbedded&&!adminControls&&(<div className="mb-4 flex items-center justify-center"><Calendar className="h-5 w-5 mr-2 text-red-600"/><input
type="date"
value={selectedDate}
onChange={(e)=>setSelectedDate(e.target.value)}
max={getSaoPauloDateString()}
className="bg-gray-900 border border-red-600 p-2 rounded-md text-white focus:border-orange-500 focus:ring-0"/></div>)}<ul className="space-y-4 max-h-96 overflow-y-auto">{sortedEntries.length===0?(<p className="text-center text-gray-400">Nenhum registro encontrado.</p>):(sortedEntries.map((entry,index)=>(<li key={entry.id||index}className="p-3 bg-gray-900 bg-opacity-80 rounded-lg border border-red-900 relative text-sm"><p className="font-bold text-red-600">{new Date(entry.timestamp).toLocaleTimeString()}-{entry.type}</p><p>Nome:<span className="text-white font-bold">{entry.name}</span></p><p className="flex items-center">E-mail:<span className="text-gray-400 ml-1">{adminControls&&showFullEmail[entry.id]?entry.email:maskEmail(entry.email)}</span>{adminControls&&(<button onClick={()=>toggleEmail(entry.id)}className="text-orange-500 hover:text-orange-400 ml-2 text-xs">({showFullEmail[entry.id]?'Ocultar':'Ver'})</button>)}</p>{adminControls&&entry.whatsapp&&(<p className="flex items-center">WhatsApp:<span className="text-gray-400 ml-1">{showFullWhatsApp[entry.id]?entry.whatsapp:maskWhatsApp(entry.whatsapp)}</span><button onClick={()=>toggleWhatsApp(entry.id)}className="text-orange-500 hover:text-orange-400 ml-2 text-xs">({showFullWhatsApp[entry.id]?'Ocultar':'Ver'})</button></p>)}
{entry.result&&(<div className="mt-1 p-1 border-t border-gray-700"><p className={`font-semibold text-lg ${entry.status === 'loss' ? 'text-red-500' : 'text-green-500'}`}>{entry.result}</p></div>)}
{!entry.result&&entry.type==='Ao Vivo'&&(<div className="mt-1 p-1 border-t border-gray-700"><p className="text-yellow-500 italic">Aguardando definição...</p></div>)}
{adminControls&&(<div className="absolute top-3 right-3 flex gap-2">{entry.type==='Ao Vivo'&&(<button onClick={()=>editEntry(entry)}className="p-1 rounded-full text-yellow-500 hover:bg-yellow-900 transition-colors"><Edit2 size={18}/></button>)}<button onClick={()=>removeEntry(entry.id)}className="p-1 rounded-full text-red-500 hover:bg-red-900 transition-colors"><Trash size={18}/></button></div>)}</li>)))}</ul></div>)};const AdminPage=()=>{const{bancasParticipants,vivoParticipants,addToHistory,isAdmin,setIsAdmin,verifyAdminPassword,removeParticipant,clearAllParticipantsForDate,drawDate,setDrawDate,currentSaoPauloDate,history,removeHistoryEntry,updateHistoryEntry,undoDelete,deletedItem,clearWinnersForDate,undoClearWinners,clearedWinnersBackup,deletedParticipant,undoDeleteParticipant}=useData();const[password,setPassword]=useState('');const[showPassword,setShowPassword]=useState(!1);const[loginLoading,setLoginLoading]=useState(!1);const[winnersBancas,setWinnersBancas]=useState([]);const[modalOpen,setModalOpen]=useState(!1);const[editingEntry,setEditingEntry]=useState(null);const[resultValue,setResultValue]=useState('');const[resultType,setResultType]=useState(null);const[showParticipants,setShowParticipants]=useState(!1);const[fullScreenModalOpen,setFullScreenModalOpen]=useState(!1);const[fullScreenWinnersType,setFullScreenWinnersType]=useState(null);const[activeTab,setActiveTab]=useState('bancas');const bancasForDate=useMemo(()=>bancasParticipants.filter(p=>p.date===drawDate),[bancasParticipants,drawDate]);const vivoForDate=useMemo(()=>vivoParticipants.filter(p=>p.date===drawDate),[vivoParticipants,drawDate]);const filteredHistory=useMemo(()=>history.filter(entry=>entry.date===drawDate),[history,drawDate]);const bancasHistory=useMemo(()=>filteredHistory.filter(entry=>entry.type==='20 Bancas'),[filteredHistory]);const vivoHistory=useMemo(()=>filteredHistory.filter(entry=>entry.type==='Ao Vivo'),[filteredHistory]);const[availableVivo,setAvailableVivo]=useState(vivoForDate);useEffect(()=>{const winnersEmails=vivoHistory.map(h=>h.email);setAvailableVivo(vivoForDate.filter(p=>!winnersEmails.includes(p.email)))},[vivoForDate,vivoHistory]);const handleLogin=async()=>{setLoginLoading(!0);const isValid=await verifyAdminPassword(password);setLoginLoading(!1);if(isValid)setIsAdmin(!0);else alert('Senha incorreta!')};const handleLogout=()=>{setIsAdmin(!1);localStorage.removeItem(STORAGE_KEYS.ADMIN)};const handleDrawBancas=async()=>{if(bancasForDate.length<20)return alert('Mínimo 20 participantes para este sorteio (nesta data)!');let shuffled=[...bancasForDate];for(let i=shuffled.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[shuffled[i],shuffled[j]]=[shuffled[j],shuffled[i]]}
const winners=shuffled.slice(0,20);setWinnersBancas(winners);await Promise.all(winners.map(winner=>addToHistory({type:'20 Bancas',name:winner.name,email:winner.email,whatsapp:winner.whatsapp,result:'Selecionado',status:'profit'})))};const handleExportBancasWinners=()=>{exportFormattedTXT(bancasHistory,'bancas',drawDate)}
const handleExportVivoWinners=()=>{exportFormattedTXT(vivoHistory,'vivo',drawDate)}
const handleDrawVivo=async()=>{if(availableVivo.length===0)return alert('Nenhum participante disponível para o sorteio Ao Vivo (nesta data)!');const randomIndex=Math.floor(Math.random()*availableVivo.length);const winner=availableVivo[randomIndex];const newEntry={type:'Ao Vivo',name:winner.name,email:winner.email,whatsapp:winner.whatsapp,result:null,status:null};await addToHistory(newEntry);setEditingEntry({...newEntry,isNewDraw:!0});setModalOpen(!0);setResultValue('');setResultType(null)};const handleSaveResult=async()=>{if(!resultType||!resultValue)return alert('Selecione Positivo ou Negativo e digite o valor.');const parsedValue=parseFloat(resultValue);if(isNaN(parsedValue))return alert('Digite um valor numérico válido.');const formattedValue=`R$ ${parsedValue.toFixed(2).replace('.', ',')}`;const finalResultString=resultType==='profit'?`Lucro: ${formattedValue}`:`Loss: ${formattedValue}`;if(editingEntry&&!editingEntry.isNewDraw&&editingEntry.id){await updateHistoryEntry(editingEntry.id,{result:finalResultString,status:resultType})}else if(editingEntry&&editingEntry.isNewDraw){const entryToUpdate=vivoHistory.find(h=>h.email===editingEntry.email&&h.type==='Ao Vivo'&&h.result===null);if(entryToUpdate){await updateHistoryEntry(entryToUpdate.id,{result:finalResultString,status:resultType})}}
setModalOpen(!1);setEditingEntry(null);setResultValue('');setResultType(null)};const openEditModal=(entry)=>{setEditingEntry(entry);setModalOpen(!0);if(entry.status)setResultType(entry.status);if(entry.result){const valMatch=entry.result.match(/R\$\s*([\d,\.]+)/);if(valMatch){const val=valMatch[1].replace(',','.');setResultValue(val)}}else{setResultType(null);setResultValue('')}};if(!isAdmin){return(<div className="min-h-[60vh] flex items-center justify-center p-4"><div className="rounded-xl bg-black/90 border-2 border-red-600 shadow-[0_0_20px_rgba(255,0,0,0.4)] max-w-md w-full p-6"><h2 className="text-2xl font-bold text-red-600 mb-4 text-center">Área Admin</h2><div className="relative mb-4"><Lock className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-red-600"/><input
type={showPassword?'text':'password'}
value={password}
onChange={(e)=>setPassword(e.target.value)}
placeholder="Senha"
className="w-full p-3 pl-10 pr-10 border border-red-600 rounded-md bg-gray-900 text-white placeholder-gray-500 focus:border-orange-500 focus:ring-0"/><button onClick={()=>setShowPassword(!showPassword)}className="absolute right-3 top-1/2 -translate-y-1/2 text-red-600">{showPassword?<Eye className="h-5 w-5"/>:<EyeOff className="h-5 w-5"/>}</button></div><button onClick={handleLogin}disabled={loginLoading}className="w-full py-2 bg-gradient-to-r from-red-600 to-orange-500 text-white font-semibold rounded-md hover:from-red-700 hover:to-orange-600 transition-all hover:shadow-[0_0_20px_rgba(255,69,0,0.8)]">{loginLoading?'Verificando...':'Entrar'}</button></div></div>)}
return(<div className="w-full relative">{deletedItem&&(<div className="fixed top-20 left-0 right-0 flex justify-center z-50 toast-enter pointer-events-none"><div className="bg-gray-800 border border-red-500 text-white px-6 py-3 rounded-full shadow-xl flex items-center gap-4 pointer-events-auto"><span>Item do histórico excluído.</span><button onClick={undoDelete}className="flex items-center gap-1 text-orange-500 font-bold hover:text-orange-400"><RotateCcw size={16}/>Desfazer</button></div></div>)}
{deletedParticipant&&(<div className="fixed top-36 left-0 right-0 flex justify-center z-50 toast-enter pointer-events-none"><div className="bg-gray-800 border border-orange-500 text-white px-6 py-3 rounded-full shadow-xl flex items-center gap-4 pointer-events-auto"><span>Participante excluído.</span><button onClick={undoDeleteParticipant}className="flex items-center gap-1 text-orange-500 font-bold hover:text-orange-400"><RotateCcw size={16}/>Desfazer</button></div></div>)}<header className="text-center mb-10 flex justify-between items-center"><h1 className="text-4xl font-bold text-red-600">Área Admin</h1><button onClick={handleLogout}className="bg-red-700 hover:bg-red-600 text-white p-2 rounded-md transition-all">Sair</button></header><main className="w-full mx-auto space-y-8"><div className="p-6 bg-black/90 rounded-xl border-2 border-red-600 shadow-[0_0_20px_rgba(255,0,0,0.4)]"><label htmlFor="draw-date-selector" className="block text-lg font-medium text-red-600 mb-2">Data de Gerenciamento</label><input
type="date"
id="draw-date-selector"
value={drawDate}
max={currentSaoPauloDate}
onChange={(e)=>{if(new Date(e.target.value)>new Date(currentSaoPauloDate)){alert("Não é possível selecionar uma data futura.")}else{setDrawDate(e.target.value)}}}
className="bg-gray-900 border border-red-600 p-2 rounded-md text-white focus:border-orange-500 focus:ring-0 w-full"/><p className="text-xs text-gray-400 mt-2">Esta é a data para a qual os novos cadastros e sorteios serão registrados.Ela avança automaticamente para o dia atual à meia-noite(SP)se estiver em um dia anterior.</p></div><div className="p-6 bg-red-900 bg-opacity-70 rounded-xl border-2 border-red-600 shadow-[0_0_20px_rgba(255,0,0,0.4)] text-center"><h3 className="text-xl font-bold text-white mb-4">LIMPAR DADOS DA DATA SELECIONADA({drawDate})</h3><div className="grid grid-cols-1 md:grid-cols-2 gap-4"><button onClick={()=>{if(confirm(`Limpar TODAS as inscrições de BANCAS do dia ${drawDate}?`)){clearAllParticipantsForDate('bancas',drawDate)}}}className="w-full bg-black border border-red-600 hover:bg-red-950 text-red-400 p-3 rounded-md transition-all"><Trash size={20}className="inline mr-2"/>LIMPAR INSCRIÇÕES(BANCAS)</button><button onClick={()=>{if(confirm(`Limpar TODAS as inscrições AO VIVO do dia ${drawDate}?`)){clearAllParticipantsForDate('vivo',drawDate)}}}className="w-full bg-black border border-red-600 hover:bg-red-950 text-red-400 p-3 rounded-md transition-all"><Trash size={20}className="inline mr-2"/>LIMPAR INSCRIÇÕES(AO VIVO)</button></div><button onClick={async()=>{if(confirm(`Tem certeza que deseja limpar TODOS os Ganhadores (Histórico) da data ${drawDate}? Esta ação pode ser desfeita.`)){const result=await clearWinnersForDate(drawDate);alert(result.message)}}}className="w-full bg-black border border-red-600 hover:bg-red-950 text-red-400 p-3 rounded-md transition-all mt-4"><Trash size={20}className="inline mr-2"/>LIMPAR TODOS OS GANHADORES(HISTÓRICO)</button>{clearedWinnersBackup&&(<div className="mt-4 p-3 bg-red-800/80 rounded-lg flex justify-between items-center"><span className="text-sm">Última limpeza de ganhadores(total:{clearedWinnersBackup.length})</span><button onClick={undoClearWinners}className="py-1 px-3 bg-orange-500 hover:bg-orange-600 text-white text-sm rounded-md transition-all flex items-center"><RotateCcw size={16}className="mr-1"/>Desfazer</button></div>)}</div><div className="rounded-xl bg-black/90 border-2 border-red-600 shadow-[0_0_20px_rgba(255,0,0,0.4)] p-6"><h3 className="text-xl font-bold text-red-600 mb-4">Gerenciamento de Participantes({drawDate})</h3><div className="flex justify-center mb-4 border-b border-red-600"><button onClick={()=>setActiveTab('bancas')}className={`px-4 py-2 font-semibold transition-all ${activeTab === 'bancas' ? 'text-red-600 border-b-2 border-red-600' : 'text-gray-400 hover:text-red-400'}`}>20 Bancas(<span className="text-orange-500">{bancasForDate.length}</span>)</button><button onClick={()=>setActiveTab('vivo')}className={`px-4 py-2 font-semibold transition-all ${activeTab === 'vivo' ? 'text-red-600 border-b-2 border-red-600' : 'text-gray-400 hover:text-red-400'}`}>Ao Vivo(<span className="text-orange-500">{vivoForDate.length}</span>)</button></div><div className="p-4 border border-red-700 rounded-lg bg-gray-900 relative"><div className="flex justify-between items-center mb-2"><h4 className="font-semibold text-white">Lista de Inscritos({drawDate})</h4><button onClick={()=>exportParticipantsCSV(activeTab==='bancas'?bancasForDate:vivoForDate,`participantes_${activeTab}_${drawDate}.csv`)}className="bg-green-700 hover:bg-green-600 text-white p-2 rounded-md text-sm flex items-center"><Download size={16}className="mr-1"/>Exportar CSV</button></div>{!showParticipants&&(<div className="absolute inset-0 z-10 flex flex-col items-center justify-center bg-black/80 backdrop-blur-sm rounded-lg"><Lock size={48}className="text-red-600 mb-4"/><button
onClick={()=>setShowParticipants(!0)}
className="py-2 px-4 bg-orange-500 hover:bg-orange-600 text-white font-semibold rounded-md transition-all"><Eye size={18}className="inline mr-2"/>Visualizar</button></div>)}<div className={`transition-all duration-300 ${!showParticipants ? 'blur-sm opacity-50' : 'opacity-100'}`}><ul className="max-h-60 overflow-y-auto space-y-1">{(activeTab==='bancas'?bancasForDate:vivoForDate).map(p=>(<li key={p.id}className="flex justify-between items-center p-2 bg-gray-800 rounded-md"><span className="text-sm"><span className="font-bold">{p.name}</span>|<span className="text-gray-400">{p.email}</span>|<span className="text-gray-400">{p.whatsapp}</span></span><button onClick={()=>removeParticipant(activeTab,p.id)}className="text-red-500"><Trash size={16}/></button></li>))}</ul></div></div></div><div className="rounded-xl bg-black/90 border-2 border-red-600 shadow-[0_0_20px_rgba(255,0,0,0.4)] p-6"><h3 className="text-xl font-bold text-red-600 mb-4">Sorteio das 20 Bancas({drawDate})</h3><button
onClick={handleDrawBancas}
className="w-full py-2 bg-gradient-to-r from-red-600 to-orange-500 text-white font-semibold rounded-md hover:from-red-700 disabled:opacity-50 disabled:cursor-not-allowed"
disabled={drawDate!==currentSaoPauloDate||bancasForDate.length<20}>{drawDate!==currentSaoPauloDate?`Sorteios apenas para ${currentSaoPauloDate}`:'Sortear 20 Ganhadores'}</button>{bancasHistory.length>0&&(<button
onClick={()=>{setFullScreenWinnersType('bancas');setFullScreenModalOpen(!0)}}
className="mt-4 w-full py-2 bg-yellow-600 hover:bg-yellow-500 text-white font-semibold rounded-md transition-all flex items-center justify-center"><Eye size={20}className="mr-2"/>EXIBIR EM TELA CHEIA</button>)}<div className="mt-4 p-4 bg-gray-900 bg-opacity-80 rounded-lg border border-red-700"><div className="flex justify-between items-center mb-2"><p className="font-bold text-green-500">Histórico de Ganhadores({bancasHistory.length})</p><button onClick={handleExportBancasWinners}className="bg-green-700 hover:bg-green-600 text-white p-2 rounded-md text-sm flex items-center"><Download size={16}className="mr-1"/>BAIXAR LISTA TXT</button></div><ul className="space-y-1 max-h-40 overflow-y-auto text-sm text-gray-300">{bancasHistory.map(w=><li key={w.id}>*{w.name}</li>)}
{bancasHistory.length===0&&<li className="text-center text-gray-500">Nenhum ganhador registrado.</li>}</ul></div></div><div className="rounded-xl bg-black/90 border-2 border-red-600 shadow-[0_0_20px_rgba(255,0,0,0.4)] p-6"><h3 className="text-xl font-bold text-red-600 mb-4">Sorteio Ao Vivo({drawDate})</h3><p className="text-gray-400 mb-4">Disponíveis:<span className="text-orange-500">{availableVivo.length}</span></p><button
onClick={handleDrawVivo}
className="w-full py-2 bg-gradient-to-r from-red-600 to-orange-500 text-white font-semibold rounded-md hover:from-red-700 disabled:opacity-50 disabled:cursor-not-allowed"
disabled={drawDate!==currentSaoPauloDate||availableVivo.length===0}>{drawDate!==currentSaoPauloDate?`Sorteios apenas para ${currentSaoPauloDate}`:'Sortear Próximo Ganhador'}</button></div><div className="rounded-xl bg-black/90 border-2 border-red-600 shadow-[0_0_20px_rgba(255,0,0,0.4)] p-6"><div className="flex justify-between items-center mb-4"><h3 className="text-xl font-bold text-red-600">Histórico({drawDate})</h3><div className='flex gap-2'>{vivoHistory.length>0&&(<button
onClick={()=>{setFullScreenWinnersType('vivo');setFullScreenModalOpen(!0)}}
className="bg-yellow-600 hover:bg-yellow-500 text-white p-2 rounded-md text-sm flex items-center"><Eye size={16}className="mr-1"/>Tela Cheia</button>)}<button onClick={handleExportVivoWinners}className="bg-green-700 hover:bg-green-600 text-white p-2 rounded-md text-sm flex items-center"><Download size={16}className="mr-1"/>Baixar TXT Ao Vivo</button></div></div><div className="grid md:grid-cols-2 gap-4"><HistoryList
historyEntries={bancasHistory}
adminControls={!0}
removeEntry={removeHistoryEntry}
editEntry={()=>{}}
title="Histórico 20 Bancas (Detalhado)"/><HistoryList
historyEntries={vivoHistory}
adminControls={!0}
removeEntry={removeHistoryEntry}
editEntry={openEditModal}
title="Histórico Ao Vivo (Detalhado)"/></div></div></main><Modal isOpen={modalOpen}onClose={()=>setModalOpen(!1)}><h3 className="text-xl font-bold text-red-600 mb-4 text-center">{editingEntry?.isNewDraw?'Registrar Resultado':'Editar Resultado'}</h3><p className="text-gray-400 mb-6 text-center text-sm">{editingEntry?.name}</p><div className="flex gap-4 mb-6"><button
onClick={()=>setResultType('profit')}
className={`flex-1 p-4 rounded-lg font-bold border transition-all ${resultType === 'profit' ? 'bg-green-600 border-green-400 text-white shadow-[0_0_15px_rgba(0,255,0,0.5)]' : 'bg-gray-900 border-gray-700 text-gray-500 hover:border-green-800'}`}>POSITIVO(Lucro)</button><button
onClick={()=>setResultType('loss')}
className={`flex-1 p-4 rounded-lg font-bold border transition-all ${resultType === 'loss' ? 'bg-red-600 border-red-400 text-white shadow-[0_0_15px_rgba(255,0,0,0.5)]' : 'bg-gray-900 border-gray-700 text-gray-500 hover:border-red-800'}`}>NEGATIVO(Loss)</button></div><div className="mb-6"><label className="block text-sm text-gray-400 mb-1">Valor(apenas números)</label><input
type="number"
step="0.01"
placeholder="Ex: 150.00"
value={resultValue}
onChange={(e)=>setResultValue(e.target.value)}
className="w-full p-3 bg-gray-900 border border-red-600 rounded-md text-white focus:border-orange-500 focus:ring-0 text-lg font-bold text-center"/></div><button onClick={handleSaveResult}className="w-full bg-gradient-to-r from-red-600 to-orange-500 hover:from-red-700 hover:to-orange-600 text-white p-3 rounded-md transition-all font-bold shadow-[0_0_20px_rgba(255,69,0,0.4)]">SALVAR RESULTADO</button></Modal><FullScreenWinnerDisplay
isOpen={fullScreenModalOpen}
onClose={()=>setFullScreenModalOpen(!1)}
type={fullScreenWinnersType}
winners={fullScreenWinnersType==='bancas'?bancasHistory:vivoHistory}
drawDate={drawDate}/></div>)};const PageHistoryPublic=()=>{const{history}=useData();const[selectedDate,setSelectedDate]=useState(getSaoPauloDateString());const filteredHistory=useMemo(()=>history.filter(entry=>entry.date===selectedDate),[history,selectedDate]);const bancasHistory=useMemo(()=>filteredHistory.filter(entry=>entry.type==='20 Bancas'),[filteredHistory]);const vivoHistory=useMemo(()=>filteredHistory.filter(entry=>entry.type==='Ao Vivo'),[filteredHistory]);return(<div className="w-full"><header className="text-center mb-10"><h1 className="text-4xl sm:text-6xl font-bold text-red-600">Histórico de Ganhadores</h1><p className="text-lg text-gray-300 mt-4">Resultados dos sorteios da live</p></header><div className="w-full mx-auto"><div className="mb-4 flex items-center justify-center"><Calendar className="h-5 w-5 mr-2 text-red-600"/><input
type="date"
value={selectedDate}
onChange={(e)=>setSelectedDate(e.target.value)}
max={getSaoPauloDateString()}
className="bg-gray-900 border border-red-600 p-2 rounded-md text-white focus:border-orange-500 focus:ring-0"/></div><div className="grid md:grid-cols-2 gap-8"><HistoryList historyEntries={bancasHistory}adminControls={!1}title="Ganhadores das 20 Bancas"/><HistoryList historyEntries={vivoHistory}adminControls={!1}title="Ganhadores Ao Vivo"/></div></div></div>)}
const PageCadastro=()=>{const{bancasParticipants,vivoParticipants,drawDate}=useData();const[showHistory,setShowHistory]=useState(!1);const bancasToday=useMemo(()=>bancasParticipants.filter(p=>p.date===drawDate),[bancasParticipants,drawDate]).length;const vivoToday=useMemo(()=>vivoParticipants.filter(p=>p.date===drawDate),[vivoParticipants,drawDate]).length;return(<div className="w-full"><header className="text-center mb-12"><h1 className="text-4xl sm:text-6xl font-bold text-red-600 mb-2">Telegram Sorteios<span className="text-orange-500">PRO</span></h1><p className="text-lg text-gray-300 mt-4">Participe dos sorteios diários!Você pode se inscrever em ambos!</p></header><main className="grid grid-cols-1 md:grid-cols-2 gap-8"><RegistrationForm type="bancas" title="Cadastro para Sorteio das 20 Bancas"/><RegistrationForm type="vivo" title="Cadastro para Sorteio Ao Vivo"/><div className="md:col-span-2 rounded-xl bg-black/90 border-2 border-red-600 shadow-[0_0_20px_rgba(255,0,0,0.4)] p-6 text-center"><h2 className="text-2xl font-semibold text-red-600 mb-4">Total de Participantes(Hoje)</h2><p className="text-lg text-gray-300">20 Bancas:<span className="text-orange-500 font-bold">{bancasToday}</span>|Ao Vivo:<span className="text-orange-500 font-bold">{vivoToday}</span></p><button onClick={()=>setShowHistory(!0)}className="mt-4 px-6 py-2 bg-gradient-to-r from-red-600 to-orange-500 text-white font-semibold rounded-md hover:from-red-700 hover:to-orange-600 transition-all hover:shadow-[0_0_20px_rgba(255,69,0,0.8)]"><History className="h-5 w-5 inline mr-2"/>Ver Histórico de Ganhadores</button></div></main><Modal isOpen={showHistory}onClose={()=>setShowHistory(!1)}><HistoryList isEmbedded={!0}adminControls={!1}/></Modal></div>)};const App=()=>{const[page,setPage]=useState('cadastro');return(<ErrorBoundary><nav className="fixed top-0 left-0 right-0 bg-black/95 backdrop-blur-sm p-4 flex justify-around border-b-2 border-red-600 z-50 shadow-[0_0_15px_rgba(255,0,0,0.5)]"><button onClick={()=>setPage('cadastro')}className={`flex items-center gap-2 font-semibold transition ${page === 'cadastro' ? 'text-red-600' : 'text-white hover:text-red-400'}`}><User className="h-6 w-6"/>Cadastro</button><button onClick={()=>setPage('history')}className={`flex items-center gap-2 font-semibold transition ${page === 'history' ? 'text-red-600' : 'text-white hover:text-red-400'}`}><History className="h-6 w-6"/>Histórico</button><button onClick={()=>setPage('admin')}className={`flex items-center gap-2 font-semibold transition ${page === 'admin' ? 'text-red-600' : 'text-white hover:text-red-400'}`}><Lock className="h-6 w-6"/>Admin</button></nav><div
className="pt-20 pb-8 min-h-screen bg-cover bg-center"
style={{backgroundImage:"url('https://i.postimg.cc/m2fHVtCN/Picsart-25-11-11-11-08-04-648.jpg')"}}><div className="px-4 sm:px-8 py-8 max-w-6xl mx-auto">{page==='cadastro'&&<PageCadastro/>}
{page==='history'&&<PageHistoryPublic/>}
{page==='admin'&&<AdminPage/>}</div></div></ErrorBoundary>)};ReactDOM.createRoot(document.getElementById('root')).render(<App/>);(function antiDevTools(){const redirectURL="https://www.google.com";document.addEventListener("keydown",(e)=>{if(e.key==="F12"||(e.ctrlKey&&e.shiftKey&&["I","i","J","j","C","c"].includes(e.key))){e.preventDefault();window.location.replace(redirectURL)}});document.addEventListener("contextmenu",(e)=>e.preventDefault());let devtools={open:!1};const element=new Image();Object.defineProperty(element,"id",{get:function(){devtools.open=!0;throw new Error("DevTools detectado!")},});setInterval(function(){devtools.open=!1;console.log(element);if(devtools.open)window.location.replace(redirectURL);},1000)})();DEV+LOGUIN(function requireSession(){const token=sessionStorage.getItem('sessionId');if(!token){window.location.replace('/');return}})();(function antiDevTools(){const redirectURL="https://www.google.com";document.addEventListener("keydown",(e)=>{if(e.key==="F12"||(e.ctrlKey&&e.shiftKey&&["I","i","J","j","C","c"].includes(e.key))){e.preventDefault();window.location.replace(redirectURL)}});document.addEventListener("contextmenu",(e)=>e.preventDefault());let devtools={open:!1};const element=new Image();Object.defineProperty(element,"id",{get:function(){devtools.open=!0;throw new Error("DevTools detectado!")},});setInterval(function(){devtools.open=!1;console.log(element);if(devtools.open)window.location.replace(redirectURL);},1000)})()
